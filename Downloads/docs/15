No No  7 Sole trader Sole trader Individual Yes Individual Sole trader organization (IP2IP)  8 Sole trader Sole trader Operating Site No Sole trader organization  9 LE representatives LE representative Yes Individual Legal Entity (IP2IP)  53  Impact assessment in order of initial uploads  4 types of initial uploaded files based on order:  1. The very first one has by definition no impact on any other file. The database is empty. We assume this will be Legal Entities.  2. Some initial uploads (after the first one) don’t affect earlier objects (Incapable doesn’t affect Legal Entity or Operating Site)  3. Some initial uploads (after the first one) only have a relationship with earlier uploaded (Operating site with Legal Entity)  4. Some initial uploads (after the first one) can update the same object (LE representative and Incapable)  We assume that for each file we initially upload after the first one, when entity matching indicates an update & not a create, either:  • there is differentiating information (attributes) for those objects, and we know for reach Party updated there should be a Notification sent that  allows us to gauge the success or failure (for example: setting an incapable flag on an existing individual).  • There is no differentiating information in the object (no Notification) and the differentiation lies, for example, in the creation of a relationship.  (e.g. LE representative that is also an incapable) and we know we will get a Notification for that.  *OnePAM InvolvedParty type 3 OnePAM  create  Events  1. The first initial load (Legal entities) is an exceptional event due to:  • The very large number of records (3M ingested ~ 8-10M disaggregated  records after processing by the Data Ingestor).  • The OnePAM External LDD is empty*.  2. The Data Distributor creates a Data Distributor UUID (DD UUID**) for each  record and stores it permanently together with identifying info (LE #) in the  DD Store. We also keep a temporary record/attribute table to tabulate create  results.  3. The DD creates the OIL files & transfers them for manual scheduling of the  upload into OnePAM External LDD by OIL. OnePAM uploads the files over a  prolonged period in the required order.  4. We capture all creation events from OnePAM External LDD to account for all  created records listed in the Record/Attr table and update the Error table for  the ones we don’t receive (after a timeout).  5. MADP will not capture Party creation events to process into an External Data  Domain (which doesn’t exist at this point).  6. Notifications with created & changed Parties & relationships are also picked  up by the UDL & create a copy of the OnePAM External LDD. 54  1a. OnePAM “External” LDD – ‘first’ initial Upload pattern  Data Distributor  Initial Load Ingested  Party Records:  Disaggregated, ING  formatted & enriched  Create OnePAM OIL files  by Partytype &  relationship type  Store OnePAM OIL  file for manual  upload schedule  Capture OnePAM  Notifications to validate  object & relationship creation  8M  records  OIL formatted  files by party &  relationship type  OnePAM  External LDD  OIL  (separate instance)  Notifications  MADP  Manual  Upload  Integration  Cell  MADP  Event Bus  External Data  Domain  (Ingested  Parties)  t0  t1 t2  Create  Events  DD Store  UUID/EM table Record/Attr table Error table  ** OIL requires always an external identifier to be present when uploading data  * We assume that if Incapables is the first upload with ‘Individual’ objects we can treat it as if it is a first initial upload as it has no relationships with Legal Entity and Operating Sites  Input  2  4  1  Create new Party DD  UUID & store Entity  matching info in the  DD Store  Log & remediate  failed updates End  t2  2  5  4 4  1 2 3 4 4  20M  records  Unite Data Lake (UDL)  OnePAM ExternalLDD  6  3  Configuration OnePAM  create  Events  1. Initial loads of the subsequent sources (Operating sites, …) must be treated  differently as there may be overlaps with existing Parties:  • We assume we know where to expect Notifications* or not.  • The OnePAM External LDD is not empty.  2. The Data Distributor matches each record on existing records in the DD Store  using demographics/LE # & disambiguates**. It creates DD UUIDs for new  Parties. We indicate for all records whether to create/update.  3. To know whether to expect a Notification for the update, if our initial upload has  higher priority on object attributes than earlier overlapping initial uploads, then  we will read the as-is view for those objects we update to see if there are really  changes on those attributes.  4. The DD creates the OIL files & transfers them for manual scheduling of the  upload into OnePAM External LDD by OIL. OnePAM uploads the files over a  prolonged period in the required order.  5. We capture all creation/update events from OnePAM External LDD to account  for all created/updated records listed in the Record/Attr table and update the  Error table for the ones we don’t receive.  55  1b. OnePAM “External” LDD – subsequent Initial uploads (1/2)  Data Distributor  Initial Load Ingested  Party Records:  Disaggregated, ING  formatted & enriched  Create OnePAM OIL files  by Partytype &  Relationship record  Store ONEPAM OIL  file for manual  upload schedule  Capture OnePAM  Notifications to validate  object/rel creation  8M  records  OIL formatted  files by party &  relationship type  OnePAM  External LDD  OIL  (separate instance)  Notifications  MADP  Manual  Upload  Integration  Cell  MADP  Event Bus  External Data  Domain  (Ingested  Parties)  t0  t1 t2  Create  Events  DD Store  UUID/EM table Record/Attr table Error table ~difference with first initial upload in red  * Notifications are triggered when data is updated. Incapables set a flag. Legal reps may not update anything if an object already exists.  ** Some ingested files have duplicates. for example, a legal representative can be related to different Legal Entities. Others not, like an Operating Site can only be attached to a single Legal Entity  Input  2  4  1  Read & do entity  matching in DD  Store~  Create new Party DD  UUID & store Entity  matching info in the  DD Store  Log & remediate  failed updates End  t2  5  5 5  1 2 2 4 5 5  Unite Data Lake (UDL)  OnePAM ExternalLDD  6  3  Configuration  2  Read FACT  API  3  3  7  If relevant, read  current Party values  from OnePAM  External LDD  4 OnePAM  create  Events  6. MADP will not capture Party creation events to process into an External Data  Domain (which doesn’t exist at this point).  7. Notifications with created & changed Parties & relationships are also picked up  by the UDL & create a copy of the OnePAM External LDD.  56  1b. OnePAM “External” LDD – subsequent Initial uploads (2/2)  Data Distributor  Initial Load Ingested  Party Records:  Disaggregated, ING  formatted & enriched  Create OnePAM OIL files  by Partytype &  Relationship record  Store ONEPAM OIL  file for manual  upload schedule  Capture OnePAM  Notifications to validate  object/rel creation  8M  records  OIL formatted  files by party &  relationship type  OnePAM  External LDD  OIL  (separate instance)  Notifications  MADP  Manual  Upload  Integration  Cell  MADP  Event Bus  External Data  Domain  (Ingested  Parties)  t0  t1 t2  Create  Events  DD Store  UUID/EM table Record/Attr table Error table  Input  2  4  1  Read & do entity  matching in DD  Store~  Create new Party DD  UUID & store Entity  matching info in the  DD Store  Log & remediate  failed updates End  t2  5  5 5  1 2 2 4 5 5  Unite Data Lake (UDL)  OnePAM ExternalLDD  6  3  Configuration  2  Read FACT  API 
 3  3  7  If relevant, read  current Party values  from OnePAM  External LDD  4 1. The daily upload contains around 20k disaggregated records which become 50 60k actually uploadable records (Parties & relationships)  2. The Data Distributor matches each record on already existing records in the DD  Store using demographics/LE # & if necessary, disambiguates* them. It creates  DD UUIDs for new Parties.  3. The DD reads all existing ingested Parties from OnePAM using the DD UUID to  compare the attributes for changes & stores the changed ones in the Record/Attr  table to account for updates.  4. The DD creates the OIL files & transfers them to OIL for automated scheduling  of the upload into OnePAM External LDD.  5. We capture all update, creation & deletion events from OnePAM to account for  all created Parties/relationships in the Record/Attr table & updated Party  attributes and update the Error table for the ones we don’t receive. Also deleted  Parties & relationships are accounted for.  6. MADP will not capture Party creation events to process into an External Data  Domain (which doesn’t exist at this point).  7. Notifications with created & changed Parties & relationships are also picked up  by the UDL & create a copy of the OnePAM External LDD  57  2a. OnePAM “External” LDD - Daily upload pattern – OIL  Daily update  disaggregated  records  (10,000s)  Read & do entity  matching in DD  Store  Create new Party DD  UUID & store Entity  matching info in the  DD Store  Read current Party  values from OnePAM  External LDD  Compare current values  with ingested and store  changed attributes for  upload validation  Create OIL files &  upload them for  automated processing  Capture OnePAM   Notifications to  validate changes  End Log & remediate  failed updates  Data Distributor 20K  records  OIL formatted  files by party &  relationship type  OnePAM  External LDD  OIL  (Shared instance)  Notifications  MADP  Automated  Upload  Integration  Cell  MADP  Event Bus  External Data  Domain  (Ingested  Parties)  t0  t1  t2  t2  Create  Events  DD Store  UUID/EM table Record/Attr table Error table  Input  Read  FACT API  Cassandra  * Disambiguation is needed when there are multiple matches coming back. There might be an external service that will be created at some point to support this.  2  3 4 5  3  1  6  Create &  update  Events  1 2 2 3 3 4 5  5 5  5  50-60K  records  Unite Data Lake (UDL)  OnePAM ExternalLDD  7 ~100k  calls  Configuration 1. The daily upload contains around 20k disaggregated records which become 50 60k actually uploadable records (Parties & relationships)  2. The Data Distributor matches each record on already existing records in the DD  Store using demographics/LE # &where necessary disambiguates them. It  creates DD UUIDs for new Parties.  3. The DD reads all existing ingested Parties from OnePAM using the DD UUID to  compare the attributes for changes & stores the changed ones in the  Record/Attr table to account for updates.  4. The DD updates attributes of existing Parties and creates new parties &  relationships as well as performs (soft) deletes using APIs*  5. The DD collects API responses to account for all created Parties & updated Party  attributes and updates the Error table for the ones where errors are thrown.  Also deleted Parties/relationships are accounted for.  6. MADP will not capture Party creation events to process into an External Data  Domain (which doesn’t exist at this point).  7. All Notifications with created & changed Parties & relationships are also picked  up by the UDL & create a copy of the OnePAM External LDD.  58  2b. OnePAM “External” LDD - Daily upload pattern – API  Daily update  disaggregated  records  (10,000s)  Read & do entity  matching in DD  Store  Create new Party DD  UUID & store Entity  matching info DD  Store  Read current Party  values from External  data stores  Compare current values  with ingested and store  changed attributes for  update validation  Update/Create  OnePAM Parties  using FACT APIs  Capture OnePAM API  responses to validate  changes  End Log & remediate  failed updates  Data Distributor 20K  records  OnePAM  External LDD  Write FACT  APIs Notifications  MADP  Integration  Cell  MADP  Event Bus  External Data  Domain  (Ingested  Parties)  t0  t1  Create  Events  DD Store  UUID/EM table Record/Attr table Error table  Input  Read FACT  API  Cassandra  *In red are the steps that are different with OIL, file-based uploads  ** we assume on average >1 API call per updated Party/relationship.  2  3 5  3  1  6  Create &  update  Events  t0+t 4  5 5  1 2 2 3 3 4 5 5  Unite Data Lake (UDL)  OnePAM ExternalLDD  7  API response  ~100k**  calls  ~100k  calls  Configuration Refresh OnePAM External LDD : exploit DD UUID as common UUID  Step 1: Start situation  Refresh file  LE #/  demographics  OnePAM External  LDD  External UUID  DD UUID  During refresh we must compare attributes between the  OnePAM External LDD and the Parties & relationships in the  refresh file  The challenge is that there is no common key of comparison  between External LDD and records in the refresh file.  We will use the DD UUID as a common key and the Data  Distributor which has all the entity matching information for  the OnePAM External LDD, which is what we want the  refresh file to compare with.  Step 2: add DD UUID to Refresh file  Entity matching: DD UUID  Refresh file  Data Distributor  Refresh  DD UUID  OnePAM External  LDD  External UUID  DD UUID  We load the refresh file to the Data Distributor who does entity  matching and adds the DD UUID to matching records. Unmatched  records from the refresh file create new DD UUIDs as they are not  yet in the External LDD.  We now can match External LDD Parties with Parties in the refresh  file through the DD UUID and compare them, as well as add the  new Parties & relationships from the Refresh file in the delta  output.  Given the volumes involved we will use the replicated OnePAM data  from the Unite Data Lake (UDL) to do the refresh rather than  production data in OnePAM.  59  * There is/was a discussion wherefor Sole Traders could be differently modeled between Main and External LDD due to different ways they could be created in the Main LDD. This discussion must be resolved. 1. The refresh contains around 8M disaggregated records which become  ~15-20M uploadable records (Parties & rels.).  
2. The Data Distributor matches each record on already existing records in  the DD Store using demographics/LE # &, if necessary, disambiguates  them. It creates DD UUIDs for new Parties.  3. DD creates files with all refresh records and the DD UUID & uploads them  to the Data Refresher (DRF) component.  4. The DRF retrieves all Parties & relationships of the OnePAM External LDD  from the UDL.  5. Both are stored in a comparison table by DD UUID & compares  differences (polygraph?) between the refresh files and OnePAM External  LDD.  6. DRF creates new files with deltas or Parties & relationships and send it to  the DD. These records are already DD UUID tagged.  7. We assume all attributes in the records have changed & store them in the  Record/Attr table to account for updates in OnePAM.  8. DD creates OIL formatted files and transfers them to OIL for manual  scheduling of the upload into OnePAM External LDD.  9. We capture all update, creation & deletion events from OnePAM and  update the Error table for the ones we don’t receive.  10. All Notifications with created/changed Parties & relationships are also  picked up by the UDL.   Refresh Ingested Party  Records:  Disaggregated, ING  formatted & enriched  Create DRF files  & upload them  for processing.  Retrieve  External LDD  dump from UDL  Send refresher  deltas back to  DD  Capture OnePAM  Notifications to validate  object/rel creation  Read & do entity  matching in DD  Store  Create new Party  DD UUID & store  Entity matching info  in the DD Store  Log & remediate  failed updates End  1 2 2 4 8  Data Refresher (DRF)  Unite Data  Lake (UDL)  OnePAM  External  LDD  Refresher delta  file  Error table  OnePAM  External LDD  Notifications  Manual  Upload  Create &  update  Events  Retrieve  OIL  (Shared  instance)  3  4  5  20M  records 100-500K  records* 6  8 9  9 9  10  3  Compare UDL  data with  refresh data  5 6  Store changed attr  in table & upload  to OnePAM
