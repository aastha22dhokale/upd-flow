Skip to main content Azure DevOps IngEurCDaaS01 / IngOne / Repos / Pull requests / P33558-DataDistributorAPI Search Account manager for DHOKALE, A. (Aastha) IngOne Overview Boards Repos Files Commits Pushes Branches Tags Pull requests Advanced Security Pipelines Test Plans Artifacts Project settings Postal Address Creation for OrganisationUnit Approve Set auto-complete Active !3903813 DHOKALE, A. (Aastha) proposes to merge feature/addres-service into develop Overview Files Updates Commits Conflicts All Changes Filter 7 changed files Inline P33558-DataDistributorAPI CreatePostalAddressRequest.java +22 /DataDistribution/src/main/java/com/ing/datadist/api/model/CreatePostalAddressRequest.java View package com.ing.datadist.api.model; import lombok.Builder; import lombok.Data; import lombok.*; @Data @NoArgsConstructor @AllArgsConstructor @Builder @Generated public class CreatePostalAddressRequest { private String postalAddressUsageType; private String countryCode; private String cityName; private String streetName; private String houseNumber; private String houseNumberAddition; private String postalCode; private String dataSource; private String effectiveDate; private String endDate; } AddressService.java +58 /DataDistribution/src/main/java/com/ing/datadist/api/service/AddressService.java View package com.ing.datadist.api.service; import com.ing.datadist.api.model.CreatePostalAddressRequest; import com.ing.datadist.configreader.CofaceOpsConfigReader; import lombok.extern.slf4j.Slf4j; import org.springframework.stereotype.Service; import java.time.ZonedDateTime; import java.time.format.DateTimeFormatter; import java.util.Collections; import java.util.List; import java.util.Map; import java.util.concurrent.ExecutionException; import static com.ing.datadist.api.utils.DataDistributionConstants.DATA_SOURCE; @Service @Slf4j public class AddressService { private final CofaceOpsConfigReader configReader; private final OnePamRepository onePamRepository; public AddressService(CofaceOpsConfigReader configReader, OnePamRepository onePamRepository) { this.configReader = configReader; this.onePamRepository = onePamRepository; } public void createPostalAddress(String uuid, String orgNumber) { log.info("Starting postal address creation for orgNumber: {} and uuid: {}", orgNumber, uuid); List<Map<String, String>> configs = configReader.fetchByOrgNumber(orgNumber); if (configs.isEmpty()) { log.warn("No config found for orgNumber: {}", orgNumber); return; } Map<String, String> config = configs.get(0); CreatePostalAddressRequest request = CreatePostalAddressRequest.builder() .postalAddressUsageType("STD") .countryCode(config.get("countryOfResidence")) .cityName(config.get("cityName")) .streetName(config.get("streetName")) .houseNumber(config.get("houseNumber")) .houseNumberAddition(config.get("houseNumberAddition")) .postalCode(config.get("postalCode")) .dataSource(DATA_SOURCE) .effectiveDate(ZonedDateTime.now().format(DateTimeFormatter.ISO_OFFSET_DATE_TIME)) .endDate(ZonedDateTime.now().plusYears(10).format(DateTimeFormatter.ISO_OFFSET_DATE_TIME)) .build(); try { onePamRepository.createPostalAddress(uuid, request).get(); log.info(" Successfully created postal address for UUID: {}", uuid); } catch (InterruptedException | ExecutionException e) { log.error(" Failed to create postal address for UUID: {}", uuid, e); Thread.currentThread().interrupt(); throw new RuntimeException("Postal address creation failed", e); } } } OnePamRepository.java +33 /DataDistribution/src/main/java/com/ing/datadist/api/service/OnePamRepository.java View log.error("Exception while printing request", e); } } public CompletableFuture<Void> createPostalAddress(String uuid, CreatePostalAddressRequest payload) { try { String url = apiProperties.getUrl() + "/v5/involved-parties/" + uuid + "/postal-addresses"; log.info("Calling OnePAM API to create postal address for UUID: {}", uuid); Request request = new RichHttpRequestBuilder() .withUrl(url) .withMethod(Method.Patch()) .withJsonContent(payload) .withHeader("X-ING-LastUpdateUser", "X-ING-LastUpdateUser") .build(); return apiClient.apply(request) .thenApply(response -> { if (response.statusCode() >= 200 && response.statusCode() < 300) { log.info("Postal address created successfully for UUID: {}", uuid); return null; } else { log.error("Failed to create postal address. Status: {}", response.statusCode()); throw new DataDistributionApiException( RegkeyEnum.CREATE_POSTAL_ADDRESS, "Failed to create postal address", "Status: " + response.statusCode() ); } }); } catch (RichHttpRequestBuilderException e) { throw new DataDistributionApiException( RegkeyEnum.CREATE_POSTAL_ADDRESS, "Failed to build request for postal address creation", e.getMessage() ); } } } OrganisationUnitService.java -1+6 /DataDistribution/src/main/java/com/ing/datadist/api/service/OrganisationUnitService.java View private final OnePamRepository onePamRepository; private final CofaceOpsConfigReader configReader; private final AddressService addressService; public OrganisationUnitService(OnePamRepository onePamRepository, CofaceOpsConfigReader configReader) { public OrganisationUnitService(OnePamRepository onePamRepository, CofaceOpsConfigReader configReader, AddressService addressService) { this.onePamRepository = onePamRepository; this.configReader = configReader; this.addressService = addressService; } public void processOrganisationUnit(String orgNumber) { UpdateExternalIdentifierOrganisationUnitRequest updateRequest = buildUpdateRequest(orgNumber); updateExternalIdentifier(uuid, updateRequest); addressService.createPostalAddress(uuid, orgNumber); } private InvolvedPartiesOrganisationUnitResponse createOrganisationUnit(String orgNumber) { } } } RegkeyEnum.java -3+3 utf-8 -> Windows-1252 /DataDistribution/src/main/java/com/ing/datadist/api/utils/RegkeyEnum.java View @Generated public enum RegkeyEnum { // âœ… OnePam endpoints //  OnePam endpoints CREATE_INVOLVED_PARTY("CREATE_INVOLVED_PARTY", HttpMethod.POST, "/v5/involved-parties"), UPDATE_EXTERNAL_IDENTIFIER("UPDATE_EXTERNAL_IDENTIFIER", HttpMethod.POST, "/v5/involved-parties/{uuid}/external-identifiers"), CREATE_ORGANISATION_UNIT_HIERARCHY("CREATE_ORGANISATION_UNIT_HIERARCHY", HttpMethod.POST, "/v1/organisation-hierarchies/relationship"), SEARCH_ORGANISATION_UNIT("SEARCH_ORGANISATION_UNIT", HttpMethod.POST, "/v2/partyandagreementsearch/involved-parties/organisation-units/search"), UPDATE_INVOLVED_PARTY("UPDATE_INVOLVED_PARTY", HttpMethod.PATCH, "/v5/involved-parties/{uuid}"); UPDATE_INVOLVED_PARTY("UPDATE_INVOLVED_PARTY", HttpMethod.PATCH, "/v5/involved-parties/{uuid}"), CREATE_POSTAL_ADDRESS("CREATE_POSTAL_ADDRESS", HttpMethod.POST, "/v5/involved-parties/{uuid}/postal-addresses"); public final String label; CofaceOpsConfigReader.java -3+19 /DataDistribution/src/main/java/com/ing/datadist/configreader/CofaceOpsConfigReader.java View import org.springframework.beans.factory.annotation.Autowired; import org.springframework.jdbc.core.JdbcTemplate; import org.springframework.stereotype.Repository; import java.util.HashMap; import java.util.List; import java.util.Map; public class CofaceOpsConfigReader { private static final String FETCH_BY_ORG_NUMBER_SQL = "SELECT OPS_ORGANISATIONUNITNAME, OPS_NUMBER, ADR_POSTALADDRESS_CNTRYCD, " + "OPS_EXTID_DATEOFISSUE, OPS_EXTID_EXPIRYDATE, OPS_UUID " + "FROM DD_COFACEOPS_TBL WHERE OPS_NUMBER = ?"; "SELECT OPS_ORGANISATIONUNITNAME, ORG_NUMBER, ADR_POSTALADDRESS_CNTRYCD, " + "ADR_POSTALADDRESS_STREETNM, ADR_POSTALADDRESS_HOUSENUM, ADR_POSTALADDRESS_HOUSEADD, " + "ADR_POSTALADDRESS_POSTALCD, ADR_POSTALADDRESS_CITYNAME, " + "OPS_EXTID_DATEOFISSUE, OPS_EXTID_EXPIRYDATE, DD_UUID " + "FROM DD_COFACEOPS_TBL WHERE ORG_NUMBER = ?"; private final JdbcTemplate jdbcTemplate; log.debug("End of fetchByOrgNumber"); return results; } public Map<String, String> fetchAddressDetails(String uuid) { String sql = "SELECT ADR_POSTALADDRESS_STREETNM, ADR_POSTALADDRESS_CITYNAME, " + "ADR_POSTALADDRESS_POSTALCD, ADR_POSTALADDRESS_CNTRYCD " + "FROM DD_COFACEOPS_TBL WHERE OPS_UUID = ?"; return jdbcTemplate.queryForObject(sql, new Object[]{uuid}, (rs, rowNum) -> { Map<String, String> result = new HashMap<>(); result.put("street", rs.getString("ADR_POSTALADDRESS_STREETNM")); result.put("city", rs.getString("ADR_POSTALADDRESS_CITYNAME")); result.put("postalCode", rs.getString("ADR_POSTALADDRESS_POSTALCD")); result.put("country", rs.getString("ADR_POSTALADDRESS_CNTRYCD")); return result; }); } } OrganisationUnitRowMapper.java -2+9 /DataDistribution/src/main/java/com/ing/datadist/configreader/OrganisationUnitRowMapper.java View public Map<String, String> mapRow(ResultSet organisationUnitResultSet, int rowNum) throws SQLException { Map<String, String> row = new HashMap<>(); row.put("organisationUnitName", organisationUnitResultSet.getString("OPS_ORGANISATIONUNITNAME")); row.put("orgNumber", organisationUnitResultSet.getString("OPS_NUMBER")); row.put("orgNumber", organisationUnitResultSet.getString("ORG_NUMBER")); row.put("countryOfResidence", organisationUnitResultSet.getString("ADR_POSTALADDRESS_CNTRYCD")); row.put("dateOfIssue", organisationUnitResultSet.getString("OPS_EXTID_DATEOFISSUE")); row.put("expiryDate", organisationUnitResultSet.getString("OPS_EXTID_EXPIRYDATE")); row.put("uuid", organisationUnitResultSet.getString("OPS_UUID")); row.put("uuid", organisationUnitResultSet.getString("DD_UUID")); row.put("logicalDataDomain", LOGICAL_DATA_DOMAIN); row.put("organisationUnitNameType", ORGANISATION_UNIT_NAME_TYPE); row.put("streetName", organisationUnitResultSet.getString("ADR_POSTALADDRESS_STREETNM")); row.put("houseNumber", organisationUnitResultSet.getString("ADR_POSTALADDRESS_HOUSENUM")); row.put("houseNumberAddition", organisationUnitResultSet.getString("ADR_POSTALADDRESS_HOUSEADD")); row.put("postalCode", organisationUnitResultSet.getString("ADR_POSTALADDRESS_POSTALCD")); row.put("cityName", organisationUnitResultSet.getString("ADR_POSTALADDRESS_CITYNAME")); return row; } } Finished loading items Showing 24 items. Showing 24 items. Finished loading items Showing 24 items. Showing 24 items. Row 2 of 5. Clickable
