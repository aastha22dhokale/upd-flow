UpdateOrganisationUnitNameV5Request request = UpdateOrganisationUnitNameV5Request.builder() 
.organisationUnitName(wrapper.getOrganisationUnitName()) .effectiveDate(ZonedDateTime.now().format(DateTimeFormatter.ISO_OFFSET_DATE_TIME)) 
.dataSource(DATA_SOURCE) .build(); update name call shld actually be like this similar to this make other calls as well fix payload to fetch actual values from wrapper 
package com.ing.datadist.api.payload; import com.ing.datadist.api.model.*; import com.ing.datadist.domain.OrganisationUnitDomainWrapper; import java.time.ZonedDateTime; 
import java.time.format.DateTimeFormatter; public class PayloadFactory { public static UpdateOrganisationUnitNameV5Request buildUpdateNamePayload( OrganisationUnitDomainWrapper wrapper, 
String newName ) { return UpdateOrganisationUnitNameV5Request.builder() .organisationUnitName(newName != null ? newName : wrapper.getOrganisationUnitName()) .dataSource(wrapper.getRecordActionType()) 
.effectiveDate(ZonedDateTime.now().format(DateTimeFormatter.ISO_OFFSET_DATE_TIME)) .build(); } public static UpdatePostalAddressV5Request buildUpdatePostalPayload( OrganisationUnitDomainWrapper wrapper ) 
{ return UpdatePostalAddressV5Request.builder() .lastVerificationDate("2023-05-03T10:11:12.999Z") .endDate("2050-12-12T23:59:59.999+02:00") .deliveryFailureReasonType("ADR_NOT_EXST") .build(); } public static UpdateDigitalAddressV5Request buildUpdateDigitalPayload( OrganisationUnitDomainWrapper wrapper ) { return UpdateDigitalAddressV5Request.builder() .fullDigitalAddress("hello@ing.com")   // TEMP CONSTANT .deliveryFailureReasonType("ADR_NOT_EXST") .dataSource("FOS_IT") .effectiveDate("2020-10-10T10:11:12.345+02:00") .endDate("2050-12-12T23:59:59.999+02:00") .build(); } } fix the class to for comparing logic properly package com.ing.datadist.api.service; import com.ing.datadist.api.model.*; import com.ing.datadist.domain.OrganisationUnitDomainWrapper; import lombok.extern.slf4j.Slf4j; import org.springframework.lang.NonNull; import org.springframework.stereotype.Service; import com.ing.datadist.api.payload.PayloadFactory; import java.util.List; import java.util.Objects; @Service @Slf4j public class UpdateOrganisationUnitService { private final OnePamRepository onePamRepository; private final AddressService addressService; private final SoftClosePostalAddressService softCloseService; public UpdateOrganisationUnitService(OnePamRepository onePamRepository, AddressService addressService, SoftClosePostalAddressService softCloseService) { this.onePamRepository = onePamRepository; this.addressService = addressService; this.softCloseService = softCloseService; } /** * MAIN ENTRY POINT */ public void updateOrganisationUnit(OrganisationUnitDomainWrapper wrapper, SearchInvolvedPartiesResponseV1 response, @NonNull Boolean apiFlag) throws Exception { String uuid = wrapper.getOpsUUID(); List<SearchOrganisationUnitResponseV1> organisationUnits = response.getOrganisationUnits(); for (SearchOrganisationUnitResponseV1 ou : organisationUnits) { // 1 — Update Name updateNameIfNeeded(uuid, wrapper, ou.getOrganisationUnitNames(), apiFlag); // 2 — Update Postal Address (Compare → Soft Close → Create New) updatePostalAddressFlow(uuid, wrapper, ou.getPostalAddresses(), apiFlag); // 3 — Update Digital Address updateDigitalAddressIfNeeded(uuid, wrapper, ou.getDigitalAddresses(), apiFlag); } } private void updateNameIfNeeded(String uuid, OrganisationUnitDomainWrapper wrapper, List<SearchOrganisationUnitNameResponseV1> names, boolean apiFlag) { //        for (SearchOrganisationUnitNameResponseV1 name : names) { //            if (!Objects.equals(wrapper.getOrganisationUnitName(), name.getOrganisationUnitName())) { //                log.info("Name changed for uuid:{} old:{} new:{}", uuid, name.getOrganisationUnitName(), wrapper.getOrganisationUnitName()); //                if (apiFlag) { //                    onePamRepository.updateOrganisationUnitName( //                            PayloadFactory.buildUpdateNamePayload(wrapper, wrapper.getOrganisationUnitName()), //                            uuid, "DD" //                    ); // //                } // //            } // //        } for (SearchOrganisationUnitNameResponseV1 name : organisationUnitNames) { if (Objects.equals(wrapper.getOrganisationUnitName(), name.getOrganisationUnitName())) { log.info("Update organisationUnit name changed for uuid:{}  old:{} new:{}  ", uuid, wrapper.getOrganisationUnitName(), name.getOrganisationUnitName()); if(apiFlag){ UpdateOrganisationUnitNameV5Request payload = PayloadFactory.buildUpdateNamePayload(wrapper, wrapper.getOrganisationUnitName()); onePamRepository.updateOrganisationUnitName(payload, uuid, "DD"); } } } } private void updatePostalAddressFlow(String uuid, OrganisationUnitDomainWrapper incoming, List<SearchOrganisationUnitAddressResponseV1> existingAddresses, boolean apiFlag) { for (SearchOrganisationUnitAddressResponseV1 existing : existingAddresses) { if (!isPostalAddressChanged(existing, incoming)) { log.info("Postal address unchanged for uuid: {}", uuid); continue; } log.info("Postal address changed for uuid: {}. Soft closing …", uuid); if (apiFlag) { // 1) SOFT CLOSE (synchronous) softCloseService.softClose(uuid); log.info("Soft close success for uuid: {}. Creating new postal address…", uuid); // 2) CREATE NEW POSTAL ADDRESS (synchronous) addressService.createPostalAddress(uuid, incoming.getOpsUUID()); log.info("New postal address created successfully for uuid: {}", uuid); } else { log.info("apiFlag false — skipping actual postal API calls for uuid: {}", uuid); } } } // Compare ALL fields in ONE method private boolean isPostalAddressChanged(SearchOrganisationUnitAddressResponseV1 existing, OrganisationUnitDomainWrapper incoming) { if (!Objects.equals(existing.getStreetName(), incoming.getPostalAddressStreetNm())) return true; if (!Objects.equals(existing.getHouseNumber(), incoming.getPostalAddressHouseNum())) return true; if (!Objects.equals(existing.getHouseNumberAddition(), incoming.getPostalAddressHouseAdd())) return true; if (!Objects.equals(existing.getPostalCode(), incoming.getPostalAddressPostalCd())) return true; if (!Objects.equals(existing.getCityName(), incoming.getPostalAddressCityName())) return true; if (!Objects.equals(existing.getCountryCode(), incoming.getPostalAddressCntryCd())) return true; return false; } private void updateDigitalAddressIfNeeded(String uuid, OrganisationUnitDomainWrapper wrapper, List<SearchOrganisationUnitDigitalAddressesV1> digitalAddresses, boolean apiFlag) { for (SearchOrganisationUnitDigitalAddressesV1 digital : digitalAddresses) { if (!Objects.equals(wrapper.getDigitalAddrEmail(), digital.getFullDigitalAddress())) { log.info("Digital address changed for uuid:{} old:{} new:{}", uuid, digital.getFullDigitalAddress(), wrapper.getDigitalAddrEmail()); if (apiFlag) { onePamRepository.updateDigitalAddress( PayloadFactory.buildUpdateDigitalPayload(wrapper), uuid, "DD" ); } } } } } package com.ing.datadist.domain; import lombok.Data; @Data public class OrganisationUnitDomainWrapper { private String opsUUID; private String orgUUID; private String orgExternalIdentifierVal; private String opsExternalIdentifierVal; private String organisationUnitName; private String postalAddressStreetNm; private String postalAddressHouseNum; private String postalAddressHouseAdd; private String postalAddressPostalCd; private String postalAddressCityName; private String postalAddressCntryCd; private String opsExtIdDateOfIssue; private String opsExtIdExpiryDate; private String digitalAddrFullTel; private String digitalAddrFullTefgn; private String digitalAddrEmail; private String recordActionType; } package com.ing.datadist.configreader; import lombok.extern.slf4j.Slf4j; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.jdbc.core.JdbcTemplate; import org.springframework.stereotype.Repository; import java.util.HashMap; import java.util.List; import java.util.Map; @Repository @Slf4j public class CofaceOpsConfigReader { private static final String FETCH_BY_ORG_NUMBER_SQL = "SELECT OPS_ORGANISATIONUNITNAME, ORG_NUMBER, ADR_POSTALADDRESS_CNTRYCD, " + "ADR_POSTALADDRESS_STREETNM, ADR_POSTALADDRESS_HOUSENUM, ADR_POSTALADDRESS_HOUSEADD, " + "ADR_POSTALADDRESS_POSTALCD, ADR_POSTALADDRESS_CITYNAME, " + "OPS_EXTID_DATEOFISSUE, OPS_EXTID_EXPIRYDATE, DD_UUID " + "FROM DD_COFACEOPS_TBL WHERE ORG_NUMBER = ?"; private final JdbcTemplate jdbcTemplate; @Autowired public CofaceOpsConfigReader(JdbcTemplate jdbcTemplate) { this.jdbcTemplate = jdbcTemplate; } public List<Map<String, String>> fetchByOrgNumber(String orgNumber) { log.debug("Start of fetchByOrgNumber"); log.debug("Fetching organisation unit config for Org Number: '{}'", orgNumber); List<Map<String, String>> results = jdbcTemplate.query( FETCH_BY_ORG_NUMBER_SQL, new Object[]{orgNumber}, new OrganisationUnitRowMapper() ); log.debug("Fetched {} record(s) from DD_COFACEOPS_TBL by Org Number", results.size()); results.forEach(row -> log.debug("Row: {}", row)); log.debug("End of fetchByOrgNumber"); return results; } public Map<String, String> fetchAddressDetails(String uuid) { String sql = "SELECT ADR_POSTALADDRESS_STREETNM, ADR_POSTALADDRESS_CITYNAME, " + "ADR_POSTALADDRESS_POSTALCD, ADR_POSTALADDRESS_CNTRYCD " + "FROM DD_COFACEOPS_TBL WHERE OPS_UUID = ?"; return jdbcTemplate.queryForObject(sql, new Object[]{uuid}, (rs, rowNum) -> { Map<String, String> result = new HashMap<>(); result.put("street", rs.getString("ADR_POSTALADDRESS_STREETNM")); result.put("city", rs.getString("ADR_POSTALADDRESS_CITYNAME")); 
result.put("postalCode", rs.getString("ADR_POSTALADDRESS_POSTALCD")); result.put("country", rs.getString("ADR_POSTALADDRESS_CNTRYCD")); return result; }); } }
