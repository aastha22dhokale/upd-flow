[INFO] 7 errors [INFO] ------------------------------------------------------------- [INFO] ------------------------------------------------------------------------ [INFO] Reactor Summary for DataDistributorAPIService 1.0.0: [INFO] [INFO] DataDistributorAPIService .......................... SUCCESS [ 11.430 s] [INFO] DataDistributorAPI-conf ............................ SUCCESS [  1.064 s] [INFO] DataDistribution ................................... FAILURE [ 15.582 s] [INFO] ------------------------------------------------------------------------ [INFO] BUILD FAILURE [INFO] ------------------------------------------------------------------------ [INFO] Total time:  28.661 s [INFO] Finished at: 2025-11-20T16:08:52+05:30 [INFO] ------------------------------------------------------------------------ [ERROR] Failed to execute goal org.apache.maven.plugins:maven-compiler-plugin:3.14.0:compile (default-compile) on project DataDistribution: Compilation failure: Compilation failure: [ERROR] /C:/Users/UU47VT/cud-II/P33558-DataDistributorAPI/DataDistribution/src/main/java/com/ing/datadist/api/service/OnePamRepository.java:[412,11] exception com.ing.apisdk.toolkit.connectivity.transport.http.japi.RichHttpRequestBuilderException is never thrown in body of corresponding try statement [ERROR] /C:/Users/UU47VT/cud-II/P33558-DataDistributorAPI/DataDistribution/src/main/java/com/ing/datadist/api/service/UpdateOrganisationUnitService.java:[58,86] cannot find symbol [ERROR]   symbol:   method buildCreatePostalPayload(com.ing.datadist.domain.OrganisationUnitDomainWrapper) [ERROR]   location: class com.ing.datadist.api.payload.PayloadFactory [ERROR] /C:/Users/UU47VT/cud-II/P33558-DataDistributorAPI/DataDistribution/src/main/java/com/ing/datadist/api/service/UpdateOrganisationUnitService.java:[108,72] cannot find symbol [ERROR]   symbol:   method getPostalAddressBuildingNm() [ERROR]   location: variable incomingWrapper of type com.ing.datadist.domain.OrganisationUnitDomainWrapper [ERROR] /C:/Users/UU47VT/cud-II/P33558-DataDistributorAPI/DataDistribution/src/main/java/com/ing/datadist/api/service/UpdateOrganisationUnitService.java:[109,84] cannot find symbol [ERROR]   symbol:   method getPostalAddressUnstructured1() [ERROR]   location: variable incomingWrapper of type com.ing.datadist.domain.OrganisationUnitDomainWrapper [ERROR] /C:/Users/UU47VT/cud-II/P33558-DataDistributorAPI/DataDistribution/src/main/java/com/ing/datadist/api/service/UpdateOrganisationUnitService.java:[110,84] cannot find symbol [ERROR]   symbol:   method getPostalAddressUnstructured2() [ERROR]   location: variable incomingWrapper of type com.ing.datadist.domain.OrganisationUnitDomainWrapper [ERROR] /C:/Users/UU47VT/cud-II/P33558-DataDistributorAPI/DataDistribution/src/main/java/com/ing/datadist/api/service/UpdateOrganisationUnitService.java:[111,84] cannot find symbol [ERROR]   symbol:   method getPostalAddressUnstructured3() [ERROR]   location: variable incomingWrapper of type com.ing.datadist.domain.OrganisationUnitDomainWrapper [ERROR] /C:/Users/UU47VT/cud-II/P33558-DataDistributorAPI/DataDistribution/src/main/java/com/ing/datadist/api/service/UpdateOrganisationUnitService.java:[112,79] cannot find symbol [ERROR]   symbol:   method getPostalAddressDeliveryInfo() [ERROR]   location: variable incomingWrapper of type com.ing.datadist.domain.OrganisationUnitDomainWrapper [ERROR] -> [Help 1] [ERROR] [ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch. [ERROR] Re-run Maven using the -X switch to enable full debug logging. [ERROR] [ERROR] For more information about the errors and possible solutions, please read the following articles: [ERROR] [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/MojoFailureException [ERROR] [ERROR] After correcting the problems, you can resume the build with the command [ERROR]   mvn <args> -rf :DataDistribution PS C:\Users\UU47VT\cud-II\P33558-DataDistributorAPI> package com.ing.datadist.api.service; import com.ing.datadist.api.model.*; import com.ing.datadist.domain.OrganisationUnitDomainWrapper; import lombok.extern.slf4j.Slf4j; import org.springframework.stereotype.Service; import org.springframework.lang.NonNull; import com.ing.datadist.api.payload.PayloadFactory; import java.util.List; import java.util.Objects; import java.util.concurrent.ExecutionException; @Service @Slf4j public class UpdateOrganisationUnitService { private final OnePamRepository onePamRepository; private static final String POSTAL_USAGE_TYPE = "RSDNT_ADR"; public UpdateOrganisationUnitService(OnePamRepository onePamRepository){ this.onePamRepository = onePamRepository; } public void updateOrganisationUnit(OrganisationUnitDomainWrapper wrapper, SearchInvolvedPartiesResponseV1 response, @NonNull Boolean apiFlag) throws Exception { String uuid = wrapper.getOpsUUID(); List<SearchOrganisationUnitResponseV1> organisationUnits = response.getOrganisationUnits(); for (SearchOrganisationUnitResponseV1 organisationUnit : organisationUnits) { List<SearchOrganisationUnitNameResponseV1> organisationUnitNames = organisationUnit.getOrganisationUnitNames(); List<SearchOrganisationUnitAddressResponseV1> postalAddresses = organisationUnit.getPostalAddresses(); List<SearchOrganisationUnitDigitalAddressesV1> digitalAddresses = organisationUnit.getDigitalAddresses(); // --- existing name logic (unchanged) --- for (SearchOrganisationUnitNameResponseV1 name : organisationUnitNames) { if (Objects.equals(wrapper.getOrganisationUnitName(), name.getOrganisationUnitName())) { log.info("Update organisationUnit name changed for uuid:{}  old:{} new:{}  ", uuid, wrapper.getOrganisationUnitName(), name.getOrganisationUnitName()); if(apiFlag){ UpdateOrganisationUnitNameV5Request payload = PayloadFactory.buildUpdateNamePayload(wrapper, wrapper.getOrganisationUnitName()); onePamRepository.updateOrganisationUnitName(payload, uuid, "DD"); } } } // --- NEW: postal compare -> soft-close -> create (all in one place) --- for (SearchOrganisationUnitAddressResponseV1 address : postalAddresses) { // Compare all postal fields in a single method boolean changed = isPostalAddressChanged(address, wrapper); if (changed) { log.info("Postal address change detected for uuid:{} - proceeding with soft-close + create", uuid); if (apiFlag) { try { // Soft-close existing postal address (POST .../close) onePamRepository.closePostalAddress(uuid, POSTAL_USAGE_TYPE).get(); // Build create payload from wrapper and call create CreatePostalAddressRequest createPayload = PayloadFactory.buildCreatePostalPayload(wrapper); onePamRepository.createPostalAddress(uuid, createPayload).get(); log.info("Postal address updated (soft-closed old, created new) for uuid: {}", uuid); } catch (InterruptedException ie) { Thread.currentThread().interrupt(); log.error("Interrupted while updating postal address for uuid {}", uuid, ie); throw ie; } catch (ExecutionException ee) { log.error("Execution exception during postal address update for uuid {}", uuid, ee); throw new RuntimeException("Postal address update failed", ee); } } else { log.info("apiFlag is false — skipping actual postal API calls for uuid {}", uuid); } } else { log.info("No postal address change for uuid:{} - skipping", uuid); } } // --- existing digital logic (unchanged) --- for (SearchOrganisationUnitDigitalAddressesV1 digitalAddress : digitalAddresses) { if (Objects.equals(wrapper.getDigitalAddrEmail(), digitalAddress.getFullDigitalAddress())) { log.info("Update organisationUnit FullDigitalAddress changed for uuid:{}  old:{} new:{} ", uuid, wrapper.getDigitalAddrEmail(), digitalAddress.getFullDigitalAddress()); if(apiFlag){ UpdateDigitalAddressV5Request payload = PayloadFactory.buildUpdateDigitalPayload(wrapper); onePamRepository.updateDigitalAddress(payload, uuid, "DD"); } } } } } /** * Single comparison method for postal address — compares the significant fields. * Returns true if any field differs (i.e. update needed). */ private boolean isPostalAddressChanged(SearchOrganisationUnitAddressResponseV1 existing, OrganisationUnitDomainWrapper incomingWrapper) { if (existing == null) return true; // Compare a comprehensive set of fields. Add/remove fields according to mapping. if (!Objects.equals(existing.getStreetName(), incomingWrapper.getPostalAddressStreetNm())) return true; if (!Objects.equals(existing.getHouseNumber(), incomingWrapper.getPostalAddressHouseNum())) return true; if (!Objects.equals(existing.getHouseNumberAddition(), incomingWrapper.getPostalAddressHouseAdd())) return true; if (!Objects.equals(existing.getPostalCode(), incomingWrapper.getPostalAddressPostalCd())) return true; if (!Objects.equals(existing.getCityName(), incomingWrapper.getPostalAddressCityName())) return true; if (!Objects.equals(existing.getCountryCode(), incomingWrapper.getPostalAddressCntryCd())) return true; if (!Objects.equals(existing.getBuildingName(), incomingWrapper.getPostalAddressBuildingNm())) return true; // if wrapper has it if (!Objects.equals(existing.getUnstructuredAddressLine1(), incomingWrapper.getPostalAddressUnstructured1())) return true; if (!Objects.equals(existing.getUnstructuredAddressLine2(), incomingWrapper.getPostalAddressUnstructured2())) return true; if (!Objects.equals(existing.getUnstructuredAddressLine3(), incomingWrapper.getPostalAddressUnstructured3())) return true; if (!Objects.equals(existing.getDeliveryInformation(), incomingWrapper.getPostalAddressDeliveryInfo())) return true; // if reached here, no significant differences return false; } } package com.ing.datadist.api.service; import com.fasterxml.jackson.core.JsonProcessingException; import com.fasterxml.jackson.databind.ObjectMapper; import com.ing.apisdk.toolkit.connectivity.api.JavaService; import com.ing.apisdk.toolkit.connectivity.transport.http.japi.RichHttpRequestBuilder; import com.ing.apisdk.toolkit.connectivity.transport.http.japi.RichHttpRequestBuilderException; import com.ing.datadist.api.config.InvolvedPartyApiProperties; import com.ing.datadist.api.exception.DataDistributionApiException; import com.ing.datadist.api.model.*; import com.ing.datadist.api.utils.RegkeyEnum; import com.twitter.finagle.http.Method; import com.twitter.finagle.http.Request; import com.twitter.finagle.http.Response; import lombok.extern.slf4j.Slf4j; import org.springframework.beans.factory.annotation.Qualifier; import org.springframework.stereotype.Component; import scala.collection.JavaConverters; import java.util.Map; import java.util.concurrent.CompletableFuture; @Slf4j @Component public class OnePamRepository { private final JavaService<Request, Response> apiClient; private final ObjectMapper objectMapper; private final InvolvedPartyApiProperties apiProperties; public OnePamRepository(@Qualifier("integrationServiceGeneric") JavaService<Request, Response> apiClient, ObjectMapper objectMapper, InvolvedPartyApiProperties apiProperties) { this.apiClient = apiClient; this.objectMapper = objectMapper; this.apiProperties = apiProperties; } public CompletableFuture<InvolvedPartiesOrganisationUnitResponse> createInvolvedParty(CreateOrganisationUnitRequest payload) { try { String url = RegkeyEnum.CREATE_INVOLVED_PARTY.endpoint; Request request = new RichHttpRequestBuilder() .withUrl(url) .withMethod(Method.Post()) .withJsonContent(payload) .withHeader("X-ING-LastUpdateUse", "IN_ADMIN") .build(); return apiClient.apply(request) .thenApply(response -> { try { return objectMapper.readValue(response.contentString(), InvolvedPartiesOrganisationUnitResponse.class); } catch (Exception e) { throw new DataDistributionApiException( RegkeyEnum.CREATE_INVOLVED_PARTY, "Failed to parse response from Involved Party API", e.getMessage() ); } }); } catch (RichHttpRequestBuilderException e) { throw new DataDistributionApiException( RegkeyEnum.CREATE_INVOLVED_PARTY, "Failed to build request for create involved party API", e.getMessage() ); } } public CompletableFuture<Void> updateExternalIdentifier(String uuid, UpdateExternalIdentifierOrganisationUnitRequest payload) { try { String url = RegkeyEnum.UPDATE_EXTERNAL_IDENTIFIER.resolveEndpoint(uuid); Request request = new RichHttpRequestBuilder() .withUrl(url) .withMethod(Method.Post()) .withJsonContent(payload) .withHeader("X-ING-LastUpdateUse", "IN_ADMIN") .build(); return apiClient.apply(request) .thenApply(response -> { if (response.statusCode() >= 200 && response.statusCode() < 300) { return null; } else { throw new DataDistributionApiException( RegkeyEnum.UPDATE_EXTERNAL_IDENTIFIER, "Failed to update external identifier", "Status: " + response.statusCode() ); } }); } catch (RichHttpRequestBuilderException e) { throw new DataDistributionApiException( RegkeyEnum.UPDATE_EXTERNAL_IDENTIFIER, "Failed to build request for update external identifier API", e.getMessage() ); } } public CompletableFuture<Void> createOrganisationUnitHierarchy(OrganisationUnitOrganisationRelationshipRequest payload) { try { String url = RegkeyEnum.CREATE_ORGANISATION_UNIT_HIERARCHY.endpoint; Request request = new RichHttpRequestBuilder() .withUrl(url) .withMethod(Method.Post()) .withJsonContent(payload) .withHeader("X-ING-LastUpdateUse", "IN_ADMIN") .build(); return apiClient.apply(request) .thenApply(response -> { if (response.statusCode() >= 200 && response.statusCode() < 300) { return null; } else { throw new DataDistributionApiException( RegkeyEnum.CREATE_ORGANISATION_UNIT_HIERARCHY, "Failed to create organisation unit hierarchy", "Status: " + response.statusCode() ); } }); } catch (RichHttpRequestBuilderException e) { throw new DataDistributionApiException( RegkeyEnum.CREATE_ORGANISATION_UNIT_HIERARCHY, "Failed to build request for organisation unit hierarchy API", e.getMessage() ); } } public CompletableFuture<SearchInvolvedPartiesResponseV1> searchInvolvedPartyByInternalIdentifier(SearchInvolvedPartiesRequestV1 payload) { try { String url = RegkeyEnum.SEARCH_ORGANISATION_UNIT.endpoint; log.info("searchInvolvedPartyByInternalIdentifier request payload: {}", payload); String jsonPayload = objectMapper.writeValueAsString(payload); Request request = new RichHttpRequestBuilder() .withUrl(url) .withMethod(Method.Post()) .withJsonContent(jsonPayload) .withHeader("Content-Type", "application/json") .build(); printRequest(request); return apiClient.apply(request) .thenApply(response -> { try { log.info("searchInvolvedPartyByInternalIdentifier response: {}", response); return objectMapper.readValue(response.contentString(), SearchInvolvedPartiesResponseV1.class); } catch (Exception e) { log.error("searchInvolvedPartyByInternalIdentifier error: {}", e.getMessage()); throw new DataDistributionApiException( RegkeyEnum.SEARCH_ORGANISATION_UNIT, "Failed to parse response from search organisation unit API", e.getMessage() ); } }); } catch (Exception e) { log.error("searchInvolvedPartyByInternalIdentifier API error: {}", e.getMessage()); throw new DataDistributionApiException( RegkeyEnum.SEARCH_ORGANISATION_UNIT, "Failed to build request for search organisation unit API", e.getMessage() ); } } public CompletableFuture<UpdateOrganisationUnitNameV5Response> updateOrganisationUnitName( UpdateOrganisationUnitNameV5Request payload, String uuid, String nameType) { try { String url = RegkeyEnum.UPDATE_ORGANISATION_UNIT_NAME.resolveEndpoint(uuid, nameType); Request request = new RichHttpRequestBuilder() .withUrl(url) .withMethod(Method.Patch()) .withJsonContent(payload) .withHeader("X-ING-LastUpdateUser", "X-ING-LastUpdateUser") .build(); return apiClient.apply(request) .thenApply(response -> { try { return objectMapper.readValue(response.contentString(), UpdateOrganisationUnitNameV5Response.class); } catch (Exception e) { throw new DataDistributionApiException( RegkeyEnum.UPDATE_ORGANISATION_UNIT_NAME, "Failed to parse response from updateOrganisationUnitName API", e.getMessage() ); } }); } catch (RichHttpRequestBuilderException e) { throw new DataDistributionApiException( RegkeyEnum.UPDATE_ORGANISATION_UNIT_NAME, "Failed to build request for updateOrganisationUnitName API", e.getMessage() ); } } public CompletableFuture<UpdateInvolvedPartyResponseV5> updateInvolvedParty(UpdateInvolvedPartyRequestV5 payload, String uuid) { try { String url = RegkeyEnum.UPDATE_INVOLVED_PARTY.resolveEndpoint(uuid); Request request = new RichHttpRequestBuilder() .withUrl(url) .withMethod(Method.Patch()) .withJsonContent(payload) .withHeader("X-ING-LastUpdateUser", "X-ING-LastUpdateUser") .build(); return apiClient.apply(request) .thenApply(response -> { try { return objectMapper.readValue(response.contentString(), UpdateInvolvedPartyResponseV5.class); } catch (Exception e) { throw new DataDistributionApiException( RegkeyEnum.UPDATE_INVOLVED_PARTY, "Failed to parse response for Update InvolvedParty Request API", e.getMessage() ); } }); } catch (RichHttpRequestBuilderException e) { throw new DataDistributionApiException( RegkeyEnum.UPDATE_INVOLVED_PARTY, "Failed to build request for Update InvolvedParty Request API", e.getMessage() ); } } private static void printRequest(Request req) { try { log.info("----- Request Details -----"); log.info("Method: {}", req.method()); log.info("URI: {}", req.uri()); log.info("Version: {}", req.version()); Map<String, String> headerMap = JavaConverters.mapAsJavaMapConverter(req.headerMap()).asJava(); for (Map.Entry<String, String> entry : headerMap.entrySet()) { log.info("Header: {}: {}", entry.getKey(), entry.getValue()); } log.info("Body: {}", req.contentString()); log.info("---------------------------"); } catch (Exception e) { log.error("Exception while printing request", e); } } public CompletableFuture<Void> createPostalAddress(String uuid, CreatePostalAddressRequest payload) { try { String url = RegkeyEnum.CREATE_POSTAL_ADDRESS.resolveEndpoint(uuid); log.info("Calling OnePAM API to create postal address for UUID: {}", uuid); Request request = new RichHttpRequestBuilder() .withUrl(url) .withMethod(Method.Patch()) .withJsonContent(payload) .withHeader("X-ING-LastUpdateUser", "X-ING-LastUpdateUser") .build(); return apiClient.apply(request) .thenApply(response -> { if (response.statusCode() >= 200 && response.statusCode() < 300) { log.info("Postal address created successfully for UUID: {}", uuid); return null; } else { log.error("Failed to create postal address. Status: {}", response.statusCode()); throw new DataDistributionApiException( RegkeyEnum.CREATE_POSTAL_ADDRESS, "Failed to create postal address", "Status: " + response.statusCode() ); } }); } catch (RichHttpRequestBuilderException e) { throw new DataDistributionApiException( RegkeyEnum.CREATE_POSTAL_ADDRESS, "Failed to build request for postal address creation", e.getMessage() ); } } //fixme need fetch the even OrganisationUnitHierarchy uuid from Accounting table later public OrganisationUnitOrganisationRelationshipResponse closeOrganisationHierarchyRelationship(String uuid) { try { String url = RegkeyEnum.CLOSE_ORGANISATION_HIERARCHY_RELATIONSHIP.resolveEndpoint(uuid); log.info("Closing Organisation Hierarchy Relationship"); log.info("Request URL: {}", url); Request request = new RichHttpRequestBuilder() .withUrl(url) .withMethod(Method.Post()) .withHeader("X-ING-LastUpdateUser", "IN_ADMIN") .build(); printRequest(request); Response response = apiClient.apply(request).get(); log.info("Response Status: {}", response.statusCode()); log.info("Response Body: {}", response.contentString()); if (response.statusCode() >= 200) { ObjectMapper mapper = new ObjectMapper(); return mapper.readValue(response.contentString(), OrganisationUnitOrganisationRelationshipResponse.class); } else { throw new DataDistributionApiException( RegkeyEnum.CLOSE_ORGANISATION_HIERARCHY_RELATIONSHIP, "Failed to close relationship", "Status: " + response.statusCode() ); } } catch (Exception e) { log.error("Exception while closing Organisation Hierarchy Relationship for uuid={}", uuid, e); throw new DataDistributionApiException( RegkeyEnum.CLOSE_ORGANISATION_HIERARCHY_RELATIONSHIP, "Error during closing organisation hierarchy relationship", e.getMessage()); } } public CompletableFuture<UpdatePostalAddressV5Response> updatePostalAddress( UpdatePostalAddressV5Request payload, String uuid, String usageType) { try { String url = RegkeyEnum.UPDATE_POSTAL_ADDRESS.resolveEndpoint(uuid, usageType); log.info("Updating Postal Address for UUID: {} usageType: {}", uuid, usageType); Request request = new RichHttpRequestBuilder() .withUrl(url) .withMethod(Method.Patch()) .withJsonContent(payload) .withHeader("X-ING-LastUpdateUser", "IN_ADMIN") .build(); return apiClient.apply(request) .thenApply(response -> { try { return objectMapper.readValue( response.contentString(), UpdatePostalAddressV5Response.class ); } catch (Exception e) { throw new DataDistributionApiException( RegkeyEnum.UPDATE_POSTAL_ADDRESS, "Failed to parse response from updatePostalAddress API", e.getMessage() ); } }); } catch (RichHttpRequestBuilderException e) { throw new DataDistributionApiException( RegkeyEnum.UPDATE_POSTAL_ADDRESS, "Failed to build request for updatePostalAddress API", e.getMessage() ); } } public CompletableFuture<UpdateDigitalAddressV5Response> updateDigitalAddress( UpdateDigitalAddressV5Request payload, String uuid, String usageType) { try { String url = RegkeyEnum.UPDATE_DIGITAL_ADDRESS.resolveEndpoint(uuid, usageType); log.info("Updating Digital Address for UUID: {} usageType: {}", uuid, usageType); Request request = new RichHttpRequestBuilder() .withUrl(url) .withMethod(Method.Patch()) .withJsonContent(payload) .withHeader("X-ING-LastUpdateUser", "IN_ADMIN") .build(); return apiClient.apply(request) .thenApply(response -> { try { return objectMapper.readValue( response.contentString(), UpdateDigitalAddressV5Response.class ); } catch (Exception e) { throw new DataDistributionApiException( RegkeyEnum.UPDATE_DIGITAL_ADDRESS, "Failed to parse response from updateDigitalAddress API", e.getMessage() ); } }); } catch (RichHttpRequestBuilderException e) { throw new DataDistributionApiException( RegkeyEnum.UPDATE_DIGITAL_ADDRESS, "Failed to build request for updateDigitalAddress API", e.getMessage() ); } } /** * Soft-close an active postal address for the given involved-party UUID and usageType. * Calls: * POST /v5/involved-parties/{uuid}/postal-addresses/{postalAddressUsageType}/close */ public CompletableFuture<Void> closePostalAddress(String uuid, String usageType) { try { String url = RegkeyEnum.CLOSE_POSTAL_ADDRESS.resolveEndpoint(uuid, usageType); log.info("Calling OnePAM API to close postal address for UUID: {} usageType: {}", uuid, usageType); Request request = new RichHttpRequestBuilder() .withUrl(url) .withMethod(Method.Post()) .withHeader("X-ING-LastUpdateUser", "IN_ADMIN") .build(); return apiClient.apply(request) .thenApply(response -> { if (response.statusCode() >= 200 && response.statusCode() < 300) { return null; } else { throw new DataDistributionApiException( RegkeyEnum.CLOSE_POSTAL_ADDRESS, "Failed to close postal address", "Status: " + response.statusCode() ); } }); } catch (RichHttpRequestBuilderException e) { throw new DataDistributionApiException( RegkeyEnum.CLOSE_POSTAL_ADDRESS, "Failed to build request for close postal address API", e.getMessage() ); } } } package com.ing.datadist.domain; import lombok.Data; @Data public class OrganisationUnitDomainWrapper { private String opsUUID; private String orgUUID; private String orgExternalIdentifierVal; private String opsExternalIdentifierVal; private String organisationUnitName; private String postalAddressStreetNm; private String postalAddressHouseNum; private String postalAddressHouseAdd; private String postalAddressPostalCd; private String postalAddressCityName; private String postalAddressCntryCd; private String opsExtIdDateOfIssue; private String opsExtIdExpiryDate; private String digitalAddrFullTel; private String digitalAddrFullTefgn; private String digitalAddrEmail; private String recordActionType; } package com.ing.datadist.domain; import lombok.Data; @Data public class OrganisationUnitDomain { private String recordActionType; private String orgExternalIdentifierVal; private String opsExternalIdentifierVal; private String organisationUnitName; private String postalAddressStreetNm; private String postalAddressHouseNum; private String postalAddressHouseAdd; private String postalAddressPostalCd; private String postalAddressCityName; private String postalAddressCntryCd; private String opsExtIdDateOfIssue; private String opsExtIdExpiryDate; private String digitalAddrFullTel; private String digitalAddrfFullTefgn; private String digitalAddrEmail; } package com.ing.datadist.configreader; import lombok.extern.slf4j.Slf4j; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.jdbc.core.JdbcTemplate; import org.springframework.stereotype.Repository; import java.util.HashMap; import java.util.List; import java.util.Map; @Repository @Slf4j public class CofaceOpsConfigReader { private static final String FETCH_BY_ORG_NUMBER_SQL = "SELECT OPS_ORGANISATIONUNITNAME, ORG_NUMBER, ADR_POSTALADDRESS_CNTRYCD, " + "ADR_POSTALADDRESS_STREETNM, ADR_POSTALADDRESS_HOUSENUM, ADR_POSTALADDRESS_HOUSEADD, " + "ADR_POSTALADDRESS_POSTALCD, ADR_POSTALADDRESS_CITYNAME, " + "OPS_EXTID_DATEOFISSUE, OPS_EXTID_EXPIRYDATE, DD_UUID " + "FROM DD_COFACEOPS_TBL WHERE ORG_NUMBER = ?"; private final JdbcTemplate jdbcTemplate; @Autowired public CofaceOpsConfigReader(JdbcTemplate jdbcTemplate) { this.jdbcTemplate = jdbcTemplate; } public List<Map<String, String>> fetchByOrgNumber(String orgNumber) { log.debug("Start of fetchByOrgNumber"); log.debug("Fetching organisation unit config for Org Number: '{}'", orgNumber); List<Map<String, String>> results = jdbcTemplate.query( FETCH_BY_ORG_NUMBER_SQL, new Object[]{orgNumber}, new OrganisationUnitRowMapper() ); log.debug("Fetched {} record(s) from DD_COFACEOPS_TBL by Org Number", results.size()); results.forEach(row -> log.debug("Row: {}", row)); log.debug("End of fetchByOrgNumber"); return results; } public Map<String, String> fetchAddressDetails(String uuid) { String sql = "SELECT ADR_POSTALADDRESS_STREETNM, ADR_POSTALADDRESS_CITYNAME, " + "ADR_POSTALADDRESS_POSTALCD, ADR_POSTALADDRESS_CNTRYCD " + "FROM DD_COFACEOPS_TBL WHERE OPS_UUID = ?"; return jdbcTemplate.queryForObject(sql, new Object[]{uuid}, (rs, rowNum) -> { Map<String, String> result = new HashMap<>(); result.put("street", rs.getString("ADR_POSTALADDRESS_STREETNM")); result.put("city", rs.getString("ADR_POSTALADDRESS_CITYNAME")); result.put("postalCode", rs.getString("ADR_POSTALADDRESS_POSTALCD")); result.put("country", rs.getString("ADR_POSTALADDRESS_CNTRYCD")); return result; }); } }
