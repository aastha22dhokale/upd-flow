Below is the exact class you asked for:

✔ Name: SoftClosePostalAddressService
✔ Builds the soft-close postal request
✔ Calls onePamRepository.softClosePostalAddress(uuid, request)
✔ Exactly same style as AddressService you provided
✔ Fully ready to be called inside UpdateOrganisationUnitService

⸻

✅ SoftClosePostalAddressService.java (FULL FILE)

package com.ing.datadist.api.service;

import com.ing.datadist.api.model.SoftClosePostalAddressRequest;
import com.ing.datadist.api.utils.DataDistributionConstants;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Service;

import java.time.ZonedDateTime;
import java.time.format.DateTimeFormatter;
import java.util.concurrent.ExecutionException;

@Service
@Slf4j
public class SoftClosePostalAddressService {

    private final OnePamRepository onePamRepository;

    public SoftClosePostalAddressService(OnePamRepository onePamRepository) {
        this.onePamRepository = onePamRepository;
    }

    /**
     * Soft-close an existing postal address for the given UUID.
     * UsageType is always RSDNT_ADR (constant).
     */
    public void softClose(String uuid) {
        log.info("Starting soft close for postal address UUID: {}", uuid);

        SoftClosePostalAddressRequest request = SoftClosePostalAddressRequest.builder()
                .usageType("RSDNT_ADR")  // constant for now
                .dataSource(DataDistributionConstants.DATA_SOURCE)
                .endDate(ZonedDateTime.now().format(DateTimeFormatter.ISO_OFFSET_DATE_TIME))
                .build();

        try {
            onePamRepository.softClosePostalAddress(uuid, request).get();
            log.info("Successfully soft closed postal address for UUID: {}", uuid);
        } catch (InterruptedException | ExecutionException e) {
            log.error("Soft close failed for UUID: {}", uuid, e);
            Thread.currentThread().interrupt();
            throw new RuntimeException("Soft close postal address failed", e);
        }
    }
}


⸻

✅ MODEL CLASS (if not present)

Create this simple request model:

package com.ing.datadist.api.model;

import lombok.Builder;
import lombok.Data;

@Data
@Builder
public class SoftClosePostalAddressRequest {
    private String usageType;
    private String dataSource;
    private String endDate;
}


⸻

✅ OnePamRepository – add this method

public CompletableFuture<Void> softClosePostalAddress(String uuid,
                                                      SoftClosePostalAddressRequest request) {
    String url = RegkeyEnum.UPDATE_POSTAL_ADDRESS.resolveEndpoint(uuid, "RSDNT_ADR");

    Request richReq = new RichHttpRequestBuilder()
            .withUrl(url)
            .withMethod(Method.Patch())
            .withJson(request)
            .build();

    return executor.executeAsync(richReq)
            .thenAccept(r -> log.info("Soft closed postal address {}", uuid));
}


⸻

✅ UpdateOrganisationUnitService — call soft close here

Inside your postal address comparison block, do:

if (updateNeeded) {
    softClosePostalAddressService.softClose(uuid);
    addressService.createPostalAddress(uuid, organisationUnit.getOrgNumber());
}


⸻

If you want, I will now generate:

✔ Full updated UpdateOrganisationUnitService
✔ Full updated OnePamRepository
✔ Full updated AddressService
✔ All request models

Just say “generate full files”.
